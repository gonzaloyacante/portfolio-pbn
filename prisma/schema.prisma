generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// CORE MODELS
// ============================================

model User {
  id       String @id @default(cuid())
  email    String @unique
  password String
  name     String?
  role     String @default("ADMIN")
}

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  sortOrder   Int       @default(0)
  projects    Project[]

  @@index([slug])
  @@index([sortOrder])
}

model Project {
  id           String         @id @default(cuid())
  title        String
  slug         String         @unique
  description  String         @db.Text
  thumbnailUrl String
  date         DateTime
  categoryId   String
  sortOrder    Int            @default(0)
  isFeatured   Boolean        @default(false)
  isActive     Boolean        @default(true)
  isDeleted    Boolean        @default(false)
  deletedAt    DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  category     Category       @relation(fields: [categoryId], references: [id])
  images       ProjectImage[]

  @@index([categoryId, date(sort: Desc)])
  @@index([categoryId, sortOrder])
  @@index([slug])
  @@index([isActive, isDeleted])
  @@index([isFeatured])
}

model ProjectImage {
  id        String  @id @default(cuid())
  url       String
  publicId  String
  order     Int
  alt       String?
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, order])
}

// ============================================
// SETTINGS - NORMALIZED (NO JSON)
// ============================================

/// Home Page Hero and Featured Settings
model HomeSettings {
  id                   String   @id @default(cuid())
  // Hero - Left Top (Titles)
  heroTitle1           String?  @default("Make-up")
  heroTitle2           String?  @default("Portfolio")
  // Hero - Left Bottom (Illustration + Name)
  illustrationUrl      String?
  illustrationAlt      String?  @default("Ilustración maquilladora")
  ownerName            String?  @default("Paola Bolívar Nievas")
  // Hero - Right (Main Image)
  heroMainImageUrl     String?
  heroMainImageAlt     String?  @default("Trabajo destacado")
  heroMainImageCaption String?
  heroImageStyle       String?  @default("original") // original, square, circle, landscape, portrait, star, etc.
  // CTA
  ctaText              String?  @default("Ver Portfolio")
  ctaLink              String?  @default("/proyectos")
  // Featured Projects Section
  showFeaturedProjects Boolean  @default(true)
  featuredTitle        String?
  featuredCount        Int      @default(6)
  // Meta
  isActive             Boolean  @default(true)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("home_settings")
}

/// About Page Bio and Profile Settings
model AboutSettings {
  id               String   @id @default(cuid())
  // Illustration
  illustrationUrl  String?
  illustrationAlt  String?  @default("Ilustración sobre mí")
  // Bio
  bioTitle         String?  @default("Hola, soy Paola.")
  bioIntro         String?  @db.Text
  bioDescription   String?  @db.Text
  // Profile Image (oval)
  profileImageUrl  String?
  profileImageAlt  String?  @default("Paola Bolívar Nievas")
  // Skills
  skills           String[] @default([])
  yearsExperience  Int?
  // Certifications (for professional credibility)
  certifications   String[] @default([])
  // Meta
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("about_settings")
}

/// Contact Page Settings with Form Labels
model ContactSettings {
  id                   String   @id @default(cuid())
  // Page Title
  pageTitle            String?  @default("Contacto")
  // Illustration
  illustrationUrl      String?
  illustrationAlt      String?  @default("Ilustración contacto")
  ownerName            String?  @default("Paola Bolívar Nievas")
  // Contact Info
  email                String?
  phone                String?
  whatsapp             String?
  location             String?
  // Form Configuration
  formTitle            String?  @default("Envíame un mensaje")
  nameLabel            String?  @default("Tu nombre")
  emailLabel           String?  @default("Tu email")
  phoneLabel           String?  @default("Tu teléfono (opcional)")
  messageLabel         String?  @default("Mensaje")
  preferenceLabel      String?  @default("¿Cómo preferís que te contacte?")
  submitLabel          String?  @default("Enviar mensaje")
  // Success Messages
  successTitle         String?  @default("¡Mensaje enviado!")
  successMessage       String?  @default("Gracias por contactarme. Te responderé lo antes posible.")
  sendAnotherLabel     String?  @default("Enviar otro mensaje")
  // Show Social Links
  showSocialLinks      Boolean  @default(true)
  // Meta
  isActive             Boolean  @default(true)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("contact_settings")
}

/// Project Display Settings
model ProjectSettings {
  id               String   @id @default(cuid())
  // Card Display Options
  showCardTitles   Boolean  @default(true)
  showCardCategory Boolean  @default(true)
  // Grid Layout Options (Future proofing)
  gridColumns      Int      @default(3)
  // Meta
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("project_settings")
}

/// Category Display Settings
model CategorySettings {
  id               String   @id @default(cuid())
  showDescription  Boolean  @default(true)
  showProjectCount Boolean  @default(true)
  // Layout
  gridColumns      Int      @default(4)
  // Meta
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("category_settings")
}

/// Testimonial Display Settings (SRP: separate from About)
model TestimonialSettings {
  id          String   @id @default(cuid())
  showOnAbout Boolean  @default(true)
  title       String?  @default("Lo que dicen mis clientes")
  maxDisplay  Int      @default(6)
  // Meta
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("testimonial_settings")
}

/// Theme Colors and Typography
model ThemeSettings {
  id              String   @id @default(cuid())
  // Light Theme Colors
  primaryColor    String   @default("#6c0a0a")
  secondaryColor  String   @default("#ffaadd")
  accentColor     String   @default("#fff1f9")
  backgroundColor String   @default("#fff1f9")
  textColor       String   @default("#000000")
  cardBgColor     String   @default("#ffaadd")
  // Dark Theme Colors
  darkPrimaryColor    String   @default("#ffaadd")
  darkSecondaryColor  String   @default("#6c0a0a")
  darkAccentColor     String   @default("#000000")
  darkBackgroundColor String   @default("#6c0a0a")
  darkTextColor       String   @default("#fff1f9")
  darkCardBgColor     String   @default("#ffaadd")
  // Typography
  // Typography - Base
  headingFont     String   @default("Poppins")
  headingFontUrl  String?
  headingFontSize Int      @default(32)
  scriptFont      String   @default("Great Vibes")
  scriptFontUrl   String?
  scriptFontSize  Int      @default(24)
  bodyFont        String   @default("Open Sans")
  bodyFontUrl     String?
  bodyFontSize    Int      @default(16)
  // Typography - Brand (Specifics)
  brandFont       String?  @default("Saira Extra Condensed") // "Make-up"
  brandFontUrl    String?
  brandFontSize   Int      @default(112)
  portfolioFont   String?  @default("Saira Extra Condensed") // "Portfolio" text
  portfolioFontUrl String?
  portfolioFontSize Int      @default(96)
  signatureFont   String?  @default("Dawning of a New Day") // "Paola Bolivar Nievas"
  signatureFontUrl String?
  signatureFontSize Int      @default(36)
  // Layout
  borderRadius    Int      @default(40)
  // Meta
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("theme_settings")
}

/// Social Media Links (Normalized)
model SocialLink {
  id        String   @id @default(cuid())
  platform  String   // instagram, tiktok, youtube, whatsapp, linkedin, facebook
  url       String
  username  String?
  icon      String?  // lucide-react icon name
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([platform])
  @@index([isActive, sortOrder])
  @@map("social_links")
}

// ============================================
// CONTENT MODELS
// ============================================

/// Testimonials (shown on About page)
model Testimonial {
  id        String   @id @default(cuid())
  name      String
  text      String   @db.Text
  position  String?
  company   String?
  avatarUrl String?
  rating    Int      @default(5)
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive, sortOrder])
}

/// Services offered by the professional (shown on Services page)
model Service {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  // Pricing
  price       Decimal? @db.Decimal(10, 2)
  priceLabel  String?  @default("desde") // "desde", "fijo", "consultar"
  duration    String?  // "2 horas", "3-4 horas"
  // Media
  imageUrl    String?
  iconName    String?  // lucide-react icon name
  // Display
  isActive    Boolean  @default(true)
  isFeatured  Boolean  @default(false)
  sortOrder   Int      @default(0)
  // Relaciones
  bookings    Booking[]
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive, sortOrder])
  @@index([slug])
  @@map("services")
}

/// Contact Form Submissions
model Contact {
  id                 String   @id @default(cuid())
  name               String
  email              String
  phone              String?
  message            String   @db.Text
  responsePreference String   @default("EMAIL") // EMAIL, PHONE, WHATSAPP
  // Admin fields
  ipAddress          String?
  userAgent          String?
  isRead             Boolean  @default(false)
  isReplied          Boolean  @default(false)
  adminNote          String?  @db.Text
  // Timestamps
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([ipAddress, createdAt])
  @@index([isRead, createdAt])
  @@map("contacts")
}

// ============================================
// ANALYTICS & SECURITY
// ============================================

model AnalyticLog {
  id         String   @id @default(uuid())
  eventType  String
  entityId   String?
  entityType String?
  timestamp  DateTime @default(now())
  ipAddress  String?
  userAgent  String?
  metadata   String?  @db.Text

  @@index([eventType, timestamp])
  @@index([entityType, entityId])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@map("password_reset_tokens")
}

// ============================================
// BOOKING SYSTEM
// ============================================

model Booking {
  id          String   @id @default(cuid())
  date        DateTime // Fecha y Hora de la reserva
  status      String   @default("PENDING") // PENDING, CONFIRMED, CANCELLED, COMPLETED
  
  // Cliente
  clientName  String
  clientEmail String
  clientPhone String?
  notes       String?  @db.Text

  // Relaciones
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id])

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([date])
  @@index([status])
  @@index([clientEmail])
  @@map("bookings")
}

