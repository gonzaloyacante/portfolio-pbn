// Prisma Schema para Portfolio PBN v2
// PostgreSQL como base de datos principal

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================
// USUARIOS Y AUTENTICACIÓN
// ============================================

enum Role {
  ADMIN
  VIEWER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hasheado con bcrypt
  name      String
  role      Role     @default(ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@map("users")
}

// ============================================
// PROYECTOS Y CATEGORÍAS
// ============================================

model ProjectCategory {
  id          String    @id @default(uuid())
  slug        String    @unique
  name        String
  description String?
  order       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  projects    Project[]

  @@index([slug])
  @@index([order])
  @@map("project_categories")
}

enum ProjectStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Project {
  id               String         @id @default(uuid())
  slug             String         @unique
  title            String
  description      String         @db.Text
  shortDescription String
  thumbnailUrl     String
  featured         Boolean        @default(false)
  order            Int            @default(0)
  status           ProjectStatus  @default(DRAFT)
  categoryId       String
  category         ProjectCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  images           ProjectImage[]
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@index([slug])
  @@index([categoryId])
  @@index([featured])
  @@index([status])
  @@index([order])
  @@map("projects")
}

model ProjectImage {
  id        String   @id @default(uuid())
  url       String
  alt       String
  order     Int      @default(0)
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([projectId])
  @@index([order])
  @@map("project_images")
}

// ============================================
// CONTACTOS
// ============================================

enum ContactStatus {
  NEW
  READ
  RESPONDED
  ARCHIVED
}

model Contact {
  id          String        @id @default(uuid())
  name        String
  email       String
  phone       String?
  subject     String
  message     String        @db.Text
  status      ContactStatus @default(NEW)
  response    String?       @db.Text
  respondedAt DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([status])
  @@index([createdAt])
  @@map("contacts")
}

// ============================================
// HABILIDADES Y REDES SOCIALES
// ============================================

model Skill {
  id          String   @id @default(uuid())
  name        String
  description String?
  level       Int      @default(50) // 0-100 percentage
  icon        String?
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([order])
  @@map("skills")
}

enum SocialPlatform {
  FACEBOOK
  INSTAGRAM
  TWITTER
  LINKEDIN
  YOUTUBE
  TIKTOK
  WHATSAPP
  EMAIL
  BEHANCE
  OTHER
}

model SocialLink {
  id        String         @id @default(uuid())
  platform  SocialPlatform
  url       String
  label     String?
  icon      String?
  order     Int            @default(0)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@index([order])
  @@map("social_links")
}

// ============================================
// CONFIGURACIÓN GLOBAL DEL PORTFOLIO (SINGLETON)
// ============================================

model PortfolioSettings {
  id                 String   @id @default("singleton")
  siteName           String
  siteDescription    String   @db.Text
  siteUrl            String
  ownerName          String
  ownerTitle         String
  ownerBio           String   @db.Text
  ownerEmail         String
  ownerPhone         String?
  ownerLocation      String?
  logoUrl            String?
  faviconUrl         String?
  ogImageUrl         String?
  metaKeywords       String?
  googleAnalyticsId  String?
  facebookPixelId    String?
  maintenanceMode    Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@map("portfolio_settings")
}

// ============================================
// SISTEMA CMS COMPLETO - DISEÑO Y LAYOUT DINÁMICO
// ============================================

// Configuración de diseño global (colores, tipografía, espaciados)
model DesignSettings {
  id        String   @id @default("singleton")
  // Colores
  primaryColor      String @default("#8B0000") // Color primario
  secondaryColor    String @default("#FFB6C1") // Color secundario
  backgroundColor   String @default("#FFF5F5") // Fondo
  textColor         String @default("#2D2D2D") // Texto
  accentColor       String @default("#D4A5A5") // Acento
  
  // Tipografía
  headingFont       String @default("Parisienne") // Fuente títulos
  bodyFont          String @default("Inter") // Fuente cuerpo
  headingSize       String @default("4rem") // Tamaño h1
  bodySize          String @default("1rem") // Tamaño texto
  lineHeight        String @default("1.6") // Altura línea
  
  // Espaciados
  containerMaxWidth String @default("1200px") // Ancho máximo
  sectionPadding    String @default("4rem 2rem") // Padding secciones
  elementSpacing    String @default("2rem") // Espaciado entre elementos
  borderRadius      String @default("0.5rem") // Radio bordes
  
  // Sombras y efectos
  boxShadow         String @default("0 4px 6px rgba(0,0,0,0.1)")
  hoverTransform    String @default("translateY(-4px)")
  transitionSpeed   String @default("0.3s")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("design_settings")
}

// Configuración de layout de secciones (orden, visibilidad, estructura)
enum SectionType {
  HERO
  ABOUT
  SKILLS
  PROJECTS
  CONTACT
  CUSTOM
}

enum SkillsLayoutType {
  GRID
  CIRCULAR
  HORIZONTAL
  VERTICAL
}

model PageSection {
  id            String      @id @default(uuid())
  pageName      String      // "home", "about", "projects", etc.
  sectionType   SectionType
  title         String?     // Título de la sección (editable)
  subtitle      String?     // Subtítulo (editable)
  order         Int         @default(0) // Orden de aparición
  visible       Boolean     @default(true)
  
  // Config específica por tipo de sección (JSON)
  config        Json        @default("{}")
  // Ejemplo config para SKILLS:
  // { "layout": "grid", "columns": 3, "showProgress": true, "cardStyle": "elevated" }
  // Ejemplo config para HERO:
  // { "imagePosition": "left", "showStats": true, "ctaButtons": ["projects", "contact"] }
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@unique([pageName, sectionType])
  @@index([pageName])
  @@index([order])
  @@map("page_sections")
}

// Bloques de contenido reutilizables (texto, imágenes, CTAs)
enum ContentBlockType {
  TEXT
  IMAGE
  CTA
  STATS
  TESTIMONIAL
  CUSTOM_HTML
}

model ContentBlock {
  id          String           @id @default(uuid())
  slug        String           @unique
  name        String           // Nombre descriptivo para admin
  type        ContentBlockType
  content     Json             // Contenido flexible en JSON
  // Ejemplo para TEXT: { "html": "<p>Mi texto</p>", "align": "center" }
  // Ejemplo para IMAGE: { "url": "...", "alt": "...", "width": "300px" }
  // Ejemplo para CTA: { "text": "Contactar", "url": "/contact", "style": "primary" }
  
  order       Int              @default(0)
  visible     Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([slug])
  @@index([type])
  @@map("content_blocks")
}
